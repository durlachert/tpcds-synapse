{
	"name": "tpc-ds query 5",
	"properties": {
		"content": {
			"query": "WITH ssr AS (\n    SELECT \n        s_store_id,\n        SUM(sales_price) AS sales,\n        SUM(profit) AS profit,\n        SUM(return_amt) AS returns,\n        SUM(net_loss) AS profit_loss\n    FROM (\n        SELECT  \n            ss_store_sk AS store_sk,\n            ss_sold_date_sk AS date_sk,\n            ss_ext_sales_price AS sales_price,\n            ss_net_profit AS profit,\n            CAST(0 AS DECIMAL(7,2)) AS return_amt,\n            CAST(0 AS DECIMAL(7,2)) AS net_loss\n        FROM synapsededicatedsqlpool.dbo.store_sales\n        UNION ALL\n        SELECT  \n            sr_store_sk AS store_sk,\n            sr_returned_date_sk AS date_sk,\n            CAST(0 AS DECIMAL(7,2)) AS sales_price,\n            CAST(0 AS DECIMAL(7,2)) AS profit,\n            sr_return_amt AS return_amt,\n            sr_net_loss AS net_loss\n        FROM synapsededicatedsqlpool.dbo.store_returns\n    ) salesreturns\n    JOIN synapsededicatedsqlpool.dbo.date_dim ON date_sk = d_date_sk\n    JOIN synapsededicatedsqlpool.dbo.store ON store_sk = s_store_sk\n    WHERE d_date BETWEEN CAST('2000-08-19' AS DATE) AND DATEADD(DAY, 14, CAST('2000-08-19' AS DATE))\n    GROUP BY s_store_id\n),\ncsr AS (\n    SELECT \n        cp_catalog_page_id,\n        SUM(sales_price) AS sales,\n        SUM(profit) AS profit,\n        SUM(return_amt) AS returns,\n        SUM(net_loss) AS profit_loss\n    FROM (\n        SELECT  \n            cs_catalog_page_sk AS page_sk,\n            cs_sold_date_sk AS date_sk,\n            cs_ext_sales_price AS sales_price,\n            cs_net_profit AS profit,\n            CAST(0 AS DECIMAL(7,2)) AS return_amt,\n            CAST(0 AS DECIMAL(7,2)) AS net_loss\n        FROM synapsededicatedsqlpool.dbo.catalog_sales\n        UNION ALL\n        SELECT  \n            cr_catalog_page_sk AS page_sk,\n            cr_returned_date_sk AS date_sk,\n            CAST(0 AS DECIMAL(7,2)) AS sales_price,\n            CAST(0 AS DECIMAL(7,2)) AS profit,\n            cr_return_amount AS return_amt,\n            cr_net_loss AS net_loss\n        FROM synapsededicatedsqlpool.dbo.catalog_returns\n    ) salesreturns\n    JOIN synapsededicatedsqlpool.dbo.date_dim ON date_sk = d_date_sk\n    JOIN synapsededicatedsqlpool.dbo.catalog_page ON page_sk = cp_catalog_page_sk\n    WHERE d_date BETWEEN CAST('2000-08-19' AS DATE) AND DATEADD(DAY, 14, CAST('2000-08-19' AS DATE))\n    GROUP BY cp_catalog_page_id\n),\nwsr AS (\n    SELECT \n        web_site_id,\n        SUM(sales_price) AS sales,\n        SUM(profit) AS profit,\n        SUM(return_amt) AS returns,\n        SUM(net_loss) AS profit_loss\n    FROM (\n        SELECT  \n            ws_web_site_sk AS wsr_web_site_sk,\n            ws_sold_date_sk AS date_sk,\n            ws_ext_sales_price AS sales_price,\n            ws_net_profit AS profit,\n            CAST(0 AS DECIMAL(7,2)) AS return_amt,\n            CAST(0 AS DECIMAL(7,2)) AS net_loss\n        FROM synapsededicatedsqlpool.dbo.web_sales\n        UNION ALL\n        SELECT  \n            ws_web_site_sk AS wsr_web_site_sk,\n            wr_returned_date_sk AS date_sk,\n            CAST(0 AS DECIMAL(7,2)) AS sales_price,\n            CAST(0 AS DECIMAL(7,2)) AS profit,\n            wr_return_amt AS return_amt,\n            wr_net_loss AS net_loss\n        FROM synapsededicatedsqlpool.dbo.web_returns\n        LEFT JOIN synapsededicatedsqlpool.dbo.web_sales\n        ON wr_item_sk = ws_item_sk AND wr_order_number = ws_order_number\n    ) salesreturns\n    JOIN synapsededicatedsqlpool.dbo.date_dim ON date_sk = d_date_sk\n    JOIN synapsededicatedsqlpool.dbo.web_site ON wsr_web_site_sk = web_site_sk\n    WHERE d_date BETWEEN CAST('2000-08-19' AS DATE) AND DATEADD(DAY, 14, CAST('2000-08-19' AS DATE))\n    GROUP BY web_site_id\n)\n\nSELECT TOP 100\n    channel,\n    id,\n    SUM(sales) AS sales,\n    SUM(returns) AS returns,\n    SUM(profit) AS profit\nFROM (\n    SELECT \n        'store channel' AS channel,\n        'store' + CAST(s_store_id AS VARCHAR(50)) AS id,\n        sales,\n        returns,\n        (profit - profit_loss) AS profit\n    FROM ssr\n\n    UNION ALL\n\n    SELECT \n        'catalog channel' AS channel,\n        'catalog_page' + CAST(cp_catalog_page_id AS VARCHAR(50)) AS id,\n        sales,\n        returns,\n        (profit - profit_loss) AS profit\n    FROM csr\n\n    UNION ALL\n\n    SELECT \n        'web channel' AS channel,\n        'web_site' + CAST(web_site_id AS VARCHAR(50)) AS id,\n        sales,\n        returns,\n        (profit - profit_loss) AS profit\n    FROM wsr\n) x\nGROUP BY ROLLUP(channel, id)\nORDER BY channel, id;\n",
			"metadata": {
				"language": "sql"
			},
			"currentConnection": {
				"databaseName": "synapsededicatedsqlpool",
				"poolName": "synapsededicatedsqlpool"
			},
			"resultLimit": 5000
		},
		"type": "SqlQuery"
	}
}